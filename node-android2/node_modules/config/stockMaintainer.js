var mongoose = require('mongoose');
var user = require('config/models');
exports.reset_stock = function(phone,callback) {
user.find({phno:phone},
function(err,users){
	if(users.length != 0){
		var id = users[0].phno;
		var med = users[0].meds;
		if(id == phone){
			for(var i=0;i<med.length;i++)
			{
			if(med[i].stock>=med[i].dosage)
			med[i].stock=med[i].stock-med[i].dosage;
			
			console.log("MED status now:"+med[i].stock);
			}
			user.findOne({ phno:phone },function(err,doc)			{doc.meds=med;
			doc.save();
			callback({'response':"Stock Sucessfully changed",'res':true,'meds':doc.meds});});
		}
		else{
			callback({'response':"Invalid 						Login",'res':false});
		}
	}else {
	callback({'response':"User doesn't exist",'res':false});
}
});
}

